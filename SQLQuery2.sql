CREATE DATABASE QLSV
GO
USE QLSV
GO
DROP DATABASE QLSV
CREATE TABLE KHOA1
(
MAKHOA varchar(10) NOT NULL,
TENKHOA nvarchar(50) not null unique,
NAMTL INT,
CONSTRAINT PK_KHOA PRIMARY KEY (MAKHOA),
CONSTRAINT U_TENKHOA UNIQUE (TENKHOA)
)
GO

CREATE TABLE SINHVIEN1
(
MASV varchar(15) not null,
TENSV nvarchar(50) not null,
NAM INT DEFAULT 1,
MAKHOA varchar(10) not null,
CONSTRAINT PK_SV1 PRIMARY KEY (MASV),
CONSTRAINT FK_SV_KHOA1 FOREIGN KEY(MAKHOA) REFERENCES KHOA1(MAKHOA),
CONSTRAINT CHK_NAM_SV1 CHECK (NAM>=1 AND NAM <=6)
)
GO

CREATE TABLE MONHOC
(
MAMH varchar(15) not null,
TENMH nvarchar(50) not null,
TINCHI INT DEFAULT 3,
MAKHOA varchar(10) not null,
CONSTRAINT PK_MONHOC PRIMARY KEY(MAMH),
CONSTRAINT FK_MH_KHOA1 FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA),
CONSTRAINT CHK_TINCHI_MAKHOA CHECK (TINCHI>=1 AND TINCHI<=6),
CONSTRAINT U_TENMH UNIQUE(TENMH)
)
GO

CREATE TABLE DIEUKIEN
(
MAMH varchar(15) not null,
MAMH_TRUOC varchar (15) not null,
CONSTRAINT PK_DIEUKIEN PRIMARY KEY(MAMH,MAMH_TRUOC),
CONSTRAINT FK_DKIEN_MHOC1 FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH),
CONSTRAINT FK_DKIEN_MHOC2 FOREIGN KEY (MAMH_TRUOC) REFERENCES MONHOC (MAMH)
)
go

CREATE TABLE HOCPHAN
(
MAHP varchar (15)not null,
MAMH varchar(15) not null,
HOCKY INT DEFAULT 1,
NAMHOC INT,
GIAOVIEN nvarchar(50) not null,
CONSTRAINT PK_HPHAN primary key (MAHP),
CONSTRAINT FK_HPHAN_MHOC FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH)
)

CREATE TABLE KQUA
(
MASV varchar (15) not null,
MAHP varchar(15) not null,
DIEM real,
Constraint PK_KQUA primary key (MASV,MAHP),
Constraint FK_KQUA_SVIEN foreign key(MASV) REFERENCES SINHVIEN1(MASV),
CONSTRAINT FK_KQUA_HPHAN FOREIGN KEY(MAHP) REFERENCES HOCPHAN(MAHP),
CONSTRAINT CHK_KQUA_DIEM CHECK (DIEM>=0 AND DIEM <=10)
)

insert into KHOA1
VALUES('TKTH',N'Thống kê tin học','2005')
insert into KHOA1
VALUES('KT',N'Kế toán','1994')


DELETE FROM KHOA1
WHERE MAKHOA='TKTH'
DELETE FROM KHOA1
WHERE MAKHOA='KT'
DELETE FROM KHOA1
WHERE MAKHOA='DL'
DELETE FROM KHOA1
WHERE MAKHOA='MKT'
DELETE FROM KHOA1
WHERE MAKHOA='QTKD'

insert into KHOA1
VALUES('QTKD',N'Quản trị kinh doanh','1992')
insert into KHOA1
VALUES('DL',N'Du lịch','2012')
insert into KHOA1
VALUES('MKT',N'Marketing','2001')
insert into KHOA1
VALUES('KT',N'Kế toán','1994')
insert into KHOA1
VALUES('TKTH',N'Thống kê tin học','2005')
DELETE FROM KHOA1
ALTER TABLE KHOA1 ADD NAMTL INT
update KHOA1 SET NAMTL='2005' WHERE MAKHOA='TKTH'
update KHOA1 SET NAMTL='1994' WHERE MAKHOA='KT'
update KHOA1 SET NAMTL='2001' WHERE MAKHOA='MKT'
update KHOA1 SET NAMTL='2012' WHERE MAKHOA='DL'
update KHOA1 SET NAMTL='1992' WHERE MAKHOA='QTKD'


alter table SINHVIEN1 ADD NGAYSINH DATE
SELECT * FROM SINHVIEN1
insert into SINHVIEN1(MASV,TENSV,NAM,MAKHOA,NGAYSINH)
values('SV001',N'Trần Lệ Quyên',2,'TKTH','2003/01/21')
insert into SINHVIEN1(MASV,TENSV,NAM,MAKHOA,NGAYSINH)
values('SV002',N'Nguyễn Thế Bình',3,'MKT','2002/06/04')
insert into SINHVIEN1(MASV,TENSV,NAM,MAKHOA,NGAYSINH)
values('SV003',N'Tô Ánh Nguyệt',2,'TKTH','2003/05/02')
insert into SINHVIEN1(MASV,TENSV,NAM,MAKHOA,NGAYSINH)
values('SV004',N'Nguyễn Thế Anh',2,'DL','2003/12/15')
insert into SINHVIEN1(MASV,TENSV,NAM,MAKHOA,NGAYSINH)
values('SV005',N'Lê Thanh Bình',2,'KT','2003/12/09')
insert into SINHVIEN1(MASV,TENSV,NAM,MAKHOA,NGAYSINH)
values('SV006',N'Phạm Quang Hậu',3,'DL','2002/10/12')
insert into SINHVIEN1(MASV,TENSV,NAM,MAKHOA,NGAYSINH)
values('SV007',N'Lê Cẩm Tú',4,'MKT','2001/02/13')
insert into SINHVIEN1(MASV,TENSV,NAM,MAKHOA,NGAYSINH)
values('SV008',N'Trương Thế Sang',4,'QTKD','2001/04/04')
insert into SINHVIEN1(MASV,TENSV,NAM,MAKHOA,NGAYSINH)
values('SV009',N'Đậu Quang Ánh',3,'TKTH','2002/12/03')
insert into SINHVIEN1(MASV,TENSV,NAM,MAKHOA,NGAYSINH)
values('SV010',N'Huỳnh Kim Chi',2,'KT','2003/10/18')
insert into SINHVIEN1(MASV,TENSV,NAM,MAKHOA,NGAYSINH)
values('SV011',N'Trịnh Đình Ánh',3,'QTKD','2002/11/15')

SELECT * FROM MONHOC
insert into MONHOC(MAMH,TENMH,TINCHI,MAKHOA)
values('CSDL',N'Cơ sở dữ liệu',3,'TKTH')
insert into MONHOC(MAMH,TENMH,TINCHI,MAKHOA)
values('CSLT',N'Cơ sở lập trình',3,'TKTH')
insert into MONHOC(MAMH,TENMH,TINCHI,MAKHOA)
values('KTVM',N'Kinh tế vi mô',3,'QTKD')
insert into MONHOC(MAMH,TENMH,TINCHI,MAKHOA)
values('MKCB',N'Marketing căn bản',3,'MKT')
insert into MONHOC(MAMH,TENMH,TINCHI,MAKHOA)
values('KTTC',N'Kế toán tài chính',3,'KT')
insert into MONHOC(MAMH,TENMH,TINCHI,MAKHOA)
values('THUD',N'Tin học ứng dụng',3,'TKTH')

SELECT * FROM DIEUKIEN
insert into DIEUKIEN(MAMH,MAMH_TRUOC)
values('CSLT','CSDL')
insert into DIEUKIEN(MAMH,MAMH_TRUOC)
values('MKCB','KTVM')
insert into DIEUKIEN(MAMH,MAMH_TRUOC)
values('KTTC','MKCB')

SELECT * FROM HOCPHAN
insert into HOCPHAN(MAHP,MAMH,HOCKY,NAMHOC,GIAOVIEN)
values('CSDL_2111','CSDL',1,2021,N'Uyên Nhi')
insert into HOCPHAN(MAHP,MAMH,HOCKY,NAMHOC,GIAOVIEN)
values('CSLT_2021','CSLT',2,2020,N'Thu Thảo')
insert into HOCPHAN(MAHP,MAMH,HOCKY,NAMHOC,GIAOVIEN)
values('KTVM_2122','KTVM',2,2021,N'Minh Hoàng')
insert into HOCPHAN(MAHP,MAMH,HOCKY,NAMHOC,GIAOVIEN)
values('MKCB_2211','MKCB',1,2022,N'Châu Linh')
insert into HOCPHAN(MAHP,MAMH,HOCKY,NAMHOC,GIAOVIEN)
values('KTTC_1922','KTTC',2,2019,N'Phương Nam')
insert into HOCPHAN(MAHP,MAMH,HOCKY,NAMHOC,GIAOVIEN)
values('THUD_2020','THUD',1,2020,N'Đình Vấn')

ALTER TABLE HOCPHAN ALTER COLUMN MAHP VARCHAR(15)


SELECT * FROM KQUA
insert into KQUA(MASV,MAHP,DIEM)
values('SV001','2111',9.0)
insert into KQUA(MASV,MAHP,DIEM)
values('SV002','2021',3.0)
insert into KQUA(MASV,MAHP,DIEM)
values('SV002','2122',7.0)
insert into KQUA(MASV,MAHP,DIEM)
values('SV004','2211',6.0)
insert into KQUA(MASV,MAHP,DIEM)
values('SV004','1922',5.0)
insert into KQUA(MASV,MAHP,DIEM)
values('SV005','2011',3.0)
insert into KQUA(MASV,MAHP,DIEM)
values('SV005','2111',6.0)
insert into KQUA(MASV,MAHP,DIEM)
values('SV006','2111',4.0)
insert into KQUA(MASV,MAHP,DIEM)
values('SV009','2011',4.0)
insert into KQUA(MASV,MAHP,DIEM)
values('SV010','2011',8.0)
insert into KQUA(MASV,MAHP,DIEM)
values('SV010','2021',7.0)

DELETE FROM KQUA
ALTER TABLE KQUA DROP FK_KQUA_HPHAN
UPDATE KQUA SET MAHP='2011' WHERE MASV='SV010' AND DIEM='7.0'
UPDATE HOCPHAN SET MAHP='2111' WHERE MAHP='CSDL_2111'
UPDATE HOCPHAN SET MAHP='2021' WHERE MAHP='CSLT_2021'
UPDATE HOCPHAN SET MAHP='1922' WHERE MAHP='KTTC_1922'
UPDATE HOCPHAN SET MAHP='2122' WHERE MAHP='KTVM_2122'
UPDATE HOCPHAN SET MAHP='2211' WHERE MAHP='MKCB_2211'
UPDATE HOCPHAN SET MAHP='2020' WHERE MAHP='THUD_2020'

