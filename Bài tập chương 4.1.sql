CREATE DATABASE QLSV2
GO
CREATE TABLE KHOA
(
MAKHOA varchar(4) constraint PK_KHOA primary key,
TENKHOA NVARCHAR(100) NOT NULL UNIQUE,
NAMTHANHLAP INT,
CONSTRAINT U_TENKHOA UNIQUE (TENKHOA)
)
DROP TABLE KHOA
CREATE TABLE SVIEN
(
MASV VARCHAR(8) CONSTRAINT PK_SVIEN PRIMARY KEY,
MAKHOA VARCHAR(4) NOT NULL,
TENSV NVARCHAR(100) NOT NULL,
NAM INT DEFAULT 1,
CONSTRAINT CHK_SVIEN_NAM CHECK (NAM>=1 AND NAM<=6),
CONSTRAINT FK_SVIEN_KHOA FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)
)
DROP TABLE SVIEN

CREATE TABLE MHOC
(
MAMH VARCHAR(6) CONSTRAINT PK_MH PRIMARY KEY,
MAKHOA VARCHAR(4) NOT NULL,
TENMH NVARCHAR(100) NOT NULL,
TINCHI INT,
CONSTRAINT CHK_TINCHI_MAKHOA CHECK (TINCHI>=1 AND TINCHI<=6),
CONSTRAINT FK_MH_KHOA FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA),
CONSTRAINT U_TENMH UNIQUE(TENMH)
)
DROP TABLE MHOC

CREATE TABLE DKIEN
(
MAMH VARCHAR(6) NOT NULL,
MAMH_TRUOC VARCHAR(6) NOT NULL,
CONSTRAINT PK_DIEUKIEN PRIMARY KEY(MAMH,MAMH_TRUOC),
CONSTRAINT FK_DKIEN_MHOC1 FOREIGN KEY (MAMH) REFERENCES MHOC(MAMH),
CONSTRAINT FK_DKIEN_MHOC2 FOREIGN KEY(MAMH_TRUOC) REFERENCES MHOC(MAMH)
)
CREATE TABLE HPHAN
(
MAHP INT CONSTRAINT PK_MAHP PRIMARY KEY,
MAMH VARCHAR(6) NOT NULL,
HOCKY INT,
NAM INT,
GV NVARCHAR(50) NOT NULL,
CONSTRAINT FK_HPHAN_MHOC FOREIGN KEY(MAMH) REFERENCES MHOC(MAMH)
)
DROP TABLE HPHAN
CREATE TABLE KETQUA
(
MASV VARCHAR(8) NOT NULL,
MAHP INT,
DIEM REAL,
CONSTRAINT PK_KETQUA PRIMARY KEY(MASV,MAHP),
CONSTRAINT FK_HPHAN_KETQUA FOREIGN KEY(MAHP) REFERENCES HPHAN(MAHP),
CONSTRAINT FK_SVIEN_KETQUA FOREIGN KEY(MASV) REFERENCES SVIEN(MASV),
CONSTRAINT CHK_DIEM_KQUA CHECK (DIEM>=0 AND DIEM <=10)
)
SELECT*FROM KHOA
INSERT INTO KHOA(MAKHOA,TENKHOA,NAMTHANHLAP)
VALUES('TOAN','Toán',1976)
INSERT INTO KHOA(MAKHOA,TENKHOA,NAMTHANHLAP)
VALUES('HOA','Hóa',1980)
INSERT INTO KHOA(MAKHOA,TENKHOA,NAMTHANHLAP)
VALUES('SINH','Sinh',1981)
INSERT INTO KHOA(MAKHOA,TENKHOA,NAMTHANHLAP)
VALUES('VLY','Vật lý',1982)

select*from svien
insert into svien(masv,tensv,nam,makhoa)
values('K27.0017',N'Nguyễn Công Phú',1,'TOAN')
insert into svien(masv,tensv,nam,makhoa)
values('K26.0008',N'Phan Anh Khanh',2,'TOAN')
insert into svien(masv,tensv,nam,makhoa)
values('K25.0005',N'Lý Thành',3,'HOA')
insert into svien(masv,tensv,nam,makhoa)
values('K27.0018',N'Hàn Quốc Việt',2,'VLY')

SELECT*FROM MHOC
INSERT INTO MHOC(MAMH,TENMH,TINCHI,MAKHOA)
VALUES('TH0001','Tin học đại cương A1',4,'TOAN')
INSERT INTO MHOC(MAMH,TENMH,TINCHI,MAKHOA)
VALUES('TH0002','Cấu trúc dữ liệu',4,'TOAN')
INSERT INTO MHOC(MAMH,TENMH,TINCHI,MAKHOA)
VALUES('TO0001','Toán rời rạc',3,'TOAN')
INSERT INTO MHOC(MAMH,TENMH,TINCHI,MAKHOA)
VALUES('HH0001','Hóa đại cương A1',5,'HOA')
INSERT INTO MHOC(MAMH,TENMH,TINCHI,MAKHOA)
VALUES('HH0002','Hóa học đại cương A2',5,'HOA')
INSERT INTO MHOC(MAMH,TENMH,TINCHI,MAKHOA)
VALUES('VL0002','Vật lý đại cương A2',4,'VLY')
INSERT INTO MHOC(MAMH,TENMH,TINCHI,MAKHOA)
VALUES('TH0003','Cơ sở dữ liệu',5,'TOAN')
INSERT INTO MHOC(MAMH,TENMH,TINCHI,MAKHOA)
VALUES('VL0001','Vật lý đại cương A1',5,'VLY')

SELECT*FROM DKIEN
INSERT INTO DKIEN
VALUES('TH0003','TO0001')
INSERT INTO DKIEN
VALUES('TH0003','TH0002')
INSERT INTO DKIEN
VALUES('TH0002','TH0001')
INSERT INTO DKIEN
VALUES('HH0002','HH0001')
INSERT INTO DKIEN
VALUES('VL0002','VL0001')

ALTER
SELECT*FROM KETQUA
INSERT INTO KETQUA
VALUES('K27.0017',4,'9.5')
INSERT INTO KETQUA
VALUES('K26.0008',1,'10')
INSERT INTO KETQUA
VALUES('K25.0005',6,'6')
INSERT INTO KETQUA
VALUES('K27.0018',2,'8')
INSERT INTO KETQUA
VALUES('K26.0008',3,'9')
DELETE FROM KETQUA
ALTER TABLE KETQUA DROP CONSTRAINT FK_HPHAN_KETQUA
ALTER TABLE KETQUA DROP CONSTRAINT FK_SVIEN_KETQUA

SELECT*FROM HPHAN
INSERT INTO HPHAN
VALUES('1','TH0001',1,'1996','N.D.Lâm')
INSERT INTO HPHAN
VALUES('2','VL0001',1,'1996','T.N.Dung')
INSERT INTO HPHAN
VALUES('3','TH0002',1,'1997','H.Tuấn')
INSERT INTO HPHAN
VALUES('4','TH0001',1,'1997','N.D.Lâm')
INSERT INTO HPHAN
VALUES('5','TH0003',2,'1997','N.C.Phú')
INSERT INTO HPHAN
VALUES('6','HH0001',1,'1996','L.T.Phúc')
INSERT INTO HPHAN
VALUES('7','TH0002',1,'1998','P.T.Như')
INSERT INTO HPHAN
VALUES('8','TO0001',1,'1996','N.C.Phú')

--1.Liệt kê tên các sinh viên thuộc khoa “Toán”(MAKHOA = “TOAN”)
USE QLSV2

