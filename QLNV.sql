create database QLNV
GO
DROP DATABASE QLNV
CREATE TABLE PHONGBAN 
(
MAPHG NVARCHAR(4) CONSTRAINT PK_PB PRIMARY KEY,
TENPHG NVARCHAR(100) NOT NULL,
TRPHG VARCHAR(8),
NGNC DATE
ALTER TABLE PHONGBAN DROP UNQ_TENPHG
GO
DROP TABLE PHONGBAN

CREATE TABLE NHANVIEN
(
MANV Nvarchar(8) CONSTRAINT PK_NV PRIMARY KEY,
HONV NVARCHAR(50) NOT NULL,
TENLOT NVARCHAR(50) NOT NULL,
TENNV NVARCHar(50) not null,
NGSINH DATETIME,
PHAI NVARCHAR(5) NOT NULL,
DCHI NVARCHAR(100) NOT NULL,
MLUONG FLOAT NOT NULL,
MA_NQL NVARCHAR(8),
PHONG NVARCHAR(4),
CONSTRAINT FK_NHANVIEN_NHANVIEN FOREIGN KEY(MA_NQL) REFERENCES NHANVIEN(MANV),
CONSTRAINT FK_NHANVIEN_PHONG FOREIGN KEY(PHONG) REFERENCES PHONGBAN(MAPHG)
ALTER TABLE NHANVIEN DROP CONSTRAINT FK_NHANVIEN_NHANVIEN 
)
GO


DROP TABLE NHANVIEN
CREATE TABLE THANNHAN
(
	MATN NVARCHAR(8) NOT NULL,
	MANV NVARCHAR(8) NOT NULL,
	TENTN NVARCHAR(50) NOT NULL,
	PHAI NVARCHAR(5),
	NGSINH DATE,
	QUANHE NVARCHAR(30),
	CONSTRAINT PK_THANNHAN PRIMARY KEY(MATN,MANV)
	--CONSTRAINT FK_THANNHAN_MANV FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
)
GO
drop
CREATE TABLE DEAN
(
MADA nvarchar(6) CONSTRAINT PK_DA PRIMARY KEY,
MAPHG nvarchar(4),
TENDA nvarchar(50) CONSTRAINT U_TENDA UNIQUE(TENDA),
DDIEM_DA nvarchar(100),
NGBD_DK DATETIME,
NGKT_DK DATETIME,
)
GO
CREATE TABLE DIADIEM_PHG
(
MAPHG nvarchar(4) CONSTRAINT FK_DD_PB FOREIGN KEY(MAPHG) REFERENCES PHONGBAN(MAPHG),
DIADIEM Nvarchar(30) CONSTRAINT PK_DD PRIMARY KEY
)
GO
CREATE TABLE DIADIEM_PHG
(
MAPHG NVARCHAR(4) NOT NULL,
DIADIEM NVARCHAR(30) NOT NULL,
CONSTRAINT PK_DIAIDIEM_PHG PRIMARY KEY(MAPHG,DIADIEM),
CONSTRAINT FK_DIADIEM_PHG FOREIGN KEY(MAPHG) REFERENCES PHONGBAN(MAPHG)
)
GO
CREATE TABLE PHANCONG
(
MANV Nvarchar(8) NOT NULL,
MADA nvarchar(6) NOT NULL,
CONSTRAINT FK_PC_DA FOREIGN KEY(MADA) REFERENCES DEAN(MADA),
CONSTRAINT FK_PC_NV1 FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
THOIGIAN float
)
ALTER TABLE DEAN ADD 
CONSTRAINT FK_DA_PB FOREIGN KEY(MAPHG) REFERENCES PHONGBAN(MAPHG)

SELECT * FROM NHANVIEN
insert into PHONGBAN (MAPHG,TENPHG,NGNC) VALUES
('QL',N'ĐIỀU HÀNH','2012/05/20')
delete from PHONGBAN
WHERE MAPHG='NC'
insert into NHANVIEN(MANV,HONV,TENLOT,TENNV,NGSINH,PHAI,DCHI,MLUONG,MA_NQL,PHONG)
VALUES('001',N'Vuong',N'Ngoc',N'Quyen','22/10/1957',N'Nu',N'450 Trung Vuong, Ha Noi',3000000,'','QL')
DELETE FROM NHANVIEN
WHERE MANV='001'
INSERT INTO NHANVIEN (MANV,HONV,TENLOT,TENNV,NGSINH,PHAI,DCHI,PHONG,MLUONG)
VALUES ('002',N'Nguyễn','Thanh',N'Tùng','09/01/1955','Nam',N'731 Trần Hưng Đạo, Q1, TpHCM','NC',2500000)

USE QL_NHANVIEN
select* from NHANVIEN
SET DATEFORMAT DMY
INSERT INTO NHANVIEN (MANV,HONV,TENLOT,TENNV,NGSINH,PHAI,DCHI,PHONG,MLUONG)
VALUES ('001',N'Vương',N'Ngọc',N'Quyên','22/10/1957',N'Nữ',N'450 Trưng Vương, Hà Nội','QL',3000000)
INSERT INTO NHANVIEN (MANV,HONV,TENLOT,TENNV,NGSINH,PHAI,DCHI,PHONG,MLUONG)
VALUES ('002',N'Nguyễn','Thanh',N'Tùng','09/01/1955','Nam',N'731 Trần Hưng Đạo, Q1, TpHCM','NC',2500000)
INSERT INTO NHANVIEN (MANV,HONV,TENLOT,TENNV,NGSINH,PHAI,DCHI,PHONG,MLUONG)
VALUES ('003',N'Lê',N'Thị',N'Nhân','18/12/1960',N'Nữ','291 Hồ Văn Huệ, QPN, TpHCM','DH',2500000)
INSERT INTO NHANVIEN (MANV,HONV,TENLOT,TENNV,NGSINH,PHAI,DCHI,PHONG,MLUONG)
VALUES ('004',N'Đinh',N'Bá','Tiên','09/01/1968','Nam',N'638 Nguyễn Văn Cừ, Q5, TpHCM','NC',2200000)
INSERT INTO NHANVIEN (MANV,HONV,TENLOT,TENNV,NGSINH,PHAI,DCHI,PHONG,MLUONG)
VALUES ('005',N'Bùi','Thuy',N'Vũ','19/07/1972','Nam',N'332 Nguyễn Thái Học, Q1, TpHCM','DH',2200000)
INSERT INTO NHANVIEN (MANV,HONV,TENLOT,TENNV,NGSINH,PHAI,DCHI,PHONG,MLUONG)
VALUES ('006',N'Nguyễn',N'Mạnh',N'Hùng','15/09/1973','Nam',N'978 Bà Rịa, Vũng Tàu','NC',2000000)
INSERT INTO NHANVIEN (MANV,HONV,TENLOT,TENNV,NGSINH,PHAI,DCHI,PHONG,MLUONG)
VALUES ('007',N'Trần','Thanh',N'Tâm','31/07/1975',N'Nữ',N'543 Mai Thị Lựu, Q1, TpHCM','NC',2200000)
INSERT INTO NHANVIEN (MANV,HONV,TENLOT,TENNV,NGSINH,PHAI,DCHI,PHONG,MLUONG)
VALUES ('008',N'Trần',N'Hồng','Vân','04/07/1976',N'Nữ',N'980 Lê Hồng Phong, Q10, TpHCM','NC',1800000)
UPDATE NHANVIEN SET MA_NQL='001' WHERE MANV='002'
UPDATE NHANVIEN SET MA_NQL='001' WHERE MANV='003'
UPDATE NHANVIEN SET MA_NQL='002' WHERE MANV='004'
UPDATE NHANVIEN SET MA_NQL='002' WHERE MANV='006'
UPDATE NHANVIEN SET MA_NQL='002' WHERE MANV='007'
UPDATE NHANVIEN SET MA_NQL='003' WHERE MANV='005'
UPDATE NHANVIEN SET MA_NQL='004' WHERE MANV='008'
UPDATE NHANVIEN SET DCHI=N'291 Hồ Văn Huệ, QPN, TpHCM' WHERE MANV='003'

--Ma than nhan la khoa chinh nen khong duoc trung lap
--Chạy sau cùng
SELECT*FROM THANNHAN
SET DATEFORMAT DMY
INSERT INTO THANNHAN(MANV,MATN,TENTN,PHAI,NGSINH,QUANHE)
VALUES('003','1',N'Trần Minh Tiến','Nam','11/12/1990','Con')
INSERT INTO THANNHAN(MANV,MATN,TENTN,PHAI,NGSINH,QUANHE)
VALUES('003','2',N'Trần Ngọc Linh',N'Nữ','10/03/1993','Con')
INSERT INTO THANNHAN(MANV,MATN,TENTN,PHAI,NGSINH,QUANHE)
VALUES('003','3',N'Trần Minh Long','Nam','10/10/1957',N'Vợ Chồng')
INSERT INTO THANNHAN(MANV,MATN,TENTN,PHAI,NGSINH,QUANHE)
VALUES('001','1',N'Lê Nhật Minh','Nam','27/04/1955',N'Vợ Chồng')
INSERT INTO THANNHAN(MANV,MATN,TENTN,PHAI,NGSINH,QUANHE)
VALUES('002','1',N'Le Hoài Thương',N'Nữ','05/12/1960',N'Vợ Chồng')
INSERT INTO THANNHAN(MANV,MATN,TENTN,PHAI,NGSINH,QUANHE)
VALUES('004','1',N'Lê Phi Phụng',N'Nữ','23/12/1972',N'Vợ Chồng')
INSERT INTO THANNHAN(MANV,MATN,TENTN,PHAI,NGSINH,QUANHE)
VALUES('005','1',N'Trần Thu Hồng','Nu','11/04/1978',N'Vợ Chồng')
INSERT INTO THANNHAN(MANV,MATN,TENTN,PHAI,NGSINH,QUANHE)
VALUES('005','2',N'Nguyễn Mạnh Tâm','Nam','13/01/2003','Con')
DELETE FROM THANNHAN

SELECT*FROM DEAN
SET DATEFORMAT DMY
INSERT INTO DEAN(MADA,TENDA,DDIEM_DA,MAPHG,NGBD_DK,NGKT_DK)
VALUES('TH001',N'Tin học hoá 1','HANOI','NC','01/02/2003','01/02/2004')
INSERT INTO DEAN(MADA,TENDA,DDIEM_DA,MAPHG,NGBD_DK,NGKT_DK)
VALUES('TH002','Tin học hóa 2','TPHCM','NC','04/06/2003','01/02/2004')
INSERT INTO DEAN(MADA,TENDA,DDIEM_DA,MAPHG,NGBD_DK,NGKT_DK)
VALUES('DT001',N'Đào tạo 1','NHATRANG','DH','01/02/2002','01/02/2006')
INSERT INTO DEAN(MADA,TENDA,DDIEM_DA,MAPHG,NGBD_DK,NGKT_DK)
VALUES('DT002',N'Đào tạo 2','HANOI','DH','01/02/2002','01/02/2006')

SELECT*FROM PHANCONG
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('001','TH001','30.0')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('001','TH002','12.5')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('002','TH001','10.0')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('002','TH002','10.0')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('002','DT001','10.0')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('002','DT002','10.0')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('003','TH001','37.5')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('004','DT001','22.5')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('004','DT002','10.0')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('006','DT001','30.5')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('007','TH001','20.0')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('007','TH002','10.0')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('008','TH001','10.0')
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN)
VALUES('008','DT002','12.5')
DELETE FROM PHANCONG


SELECT*FROM DIADIEM_PHG
INSERT INTO DIADIEM_PHG (MAPHG,DIADIEM)
VALUES('NC','HANOI')
INSERT INTO DIADIEM_PHG (MAPHG,DIADIEM)
VALUES('NC','TPHCM')
INSERT INTO DIADIEM_PHG (MAPHG,DIADIEM)
VALUES('QL','TPHCM')
INSERT INTO DIADIEM_PHG (MAPHG,DIADIEM)
VALUES('DH','HANOI')
INSERT INTO DIADIEM_PHG (MAPHG,DIADIEM)
VALUES('DH','TPHCM')
INSERT INTO DIADIEM_PHG (MAPHG,DIADIEM)
VALUES('DH','NHATRANG')
delete from DIADIEM_PHG

SELECT*FROM PHONGBAN
SET DATEFORMAT DMY
INSERT INTO PHONGBAN (MAPHG,TENPHG,NGNC)
VALUES ('QL',N'Quản Lý','22/05/2000')
INSERT INTO PHONGBAN (MAPHG,TENPHG,NGNC)
VALUES ('DH',N'Điều Hành','10/10/2002')
INSERT INTO PHONGBAN (MAPHG,TENPHG,NGNC)
VALUES ('NC',N'Nghiên Cứu','15/03/2002')
UPDATE PHONGBAN SET TRPHG='001' WHERE MAPHG='QL'
UPDATE PHONGBAN SET TRPHG='003' WHERE MAPHG='DH'
UPDATE PHONGBAN SET TRPHG='002' WHERE MAPHG='NC'
DELETE FROM PHONGBAN

